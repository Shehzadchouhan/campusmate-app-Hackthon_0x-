<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusMate - Browse Students</title> <!-- Apply dark mode early (before CSS loads) -->
    <script>
        if (localStorage.getItem("theme") === "dark") {
            document.documentElement.classList.add("dark-mode");
        }
    </script>

    <link rel="icon" href="assets/fav4.jpg" type="image/x-icon">


    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="browse.css">
</head>

<body>
    <button id="toggleModeBtn" style="position: fixed; top: 10px; right: 10px; z-index: 1001;">
        ğŸŒ™ Dark Mode
    </button>

    <div class="container header-row">
        <h1>ğŸŒ Browse Students</h1>
        <a href="connection.html" class="connections-button" id="connectionsBtn">
            ğŸ“‡ My Connections
            <span id="connectionsBadge"></span>
        </a>
    </div>

    <!-- Filters -->
    <div class="filters">
        <select id="departmentFilter">
            <option value="">All Departments</option>
            <option value="CSE">CSE</option>
            <option value="ECE">ECE</option>
            <option value="ME">ME</option>
        </select>

        <select id="yearFilter">
            <option value="">All Years</option>
            <option value="1st">1st Year</option>
            <option value="2nd">2nd Year</option>
            <option value="3rd">3rd Year</option>
        </select>

        <select id="skillFilter">
            <option value="">All Skills</option>
            <option value="Web Development">Web Development</option>
            <option value="AI/ML">AI/ML</option>
            <option value="Design">Design</option>
        </select>
    </div>


    <!-- Student Cards -->
    <div id="studentList" class="card-grid"></div>

    <!-- Bottom Navbar -->
    <nav class="bottom-navbar">
        <a href="index.html"><button class="nav-btn"><span>ğŸ </span><small>Home</small></button></a>
        <a href="browse.html"><button class="nav-btn"><span>ğŸŒ</span><small>Browse</small></button></a>
        <a href="connection.html"><button class="nav-btn"><span>ğŸ¤</span><small>Connections</small></button></a>
        <a href="profile.html"><button class="nav-btn"><span>ğŸ‘¤</span><small>Profile</small></button></a>
    </nav>
    <script>
        const students = [
            {
                name: "Mohd Shehzad",
                year: "2nd",
                department: "CSE",
                skills: ["Web Development", "Design"],
                image: "assets/profile_pic.jpg"
            },
            {
                name: "Ayesha Khan",
                year: "1st",
                department: "ECE",
                skills: ["AI/ML"],
                image: "assets/ayesha khan.jpg"
            },
            {
                name: "Rahul Verma",
                year: "3rd",
                department: "ME",
                skills: ["Design"],
                image: "assets/rahul.jpg"
            },
            {
                name: "Sneha Gupta",
                year: "2nd",
                department: "CSE",
                skills: ["AI/ML", "Web Development"],
                image: "assets/sneha gupta.jpg"
            }
        ];

        const studentList = document.getElementById("studentList");

        function renderStudents(filterDept = "", filterYear = "", filterSkill = "") {
            studentList.innerHTML = "";

            const incomingRequests = JSON.parse(localStorage.getItem("incomingRequests") || "[]");

            const filtered = students.filter(student => {
                const matchesDept = !filterDept || student.department === filterDept;
                const matchesYear = !filterYear || student.year === filterYear;
                const matchesSkill = !filterSkill || student.skills.includes(filterSkill);
                return matchesDept && matchesYear && matchesSkill;
            });

            filtered.forEach(student => {
                const alreadySent = incomingRequests.some(req => req.name === student.name);

                const card = document.createElement("div");
                card.className = "student-card";
                card.innerHTML = `
            <img src="${student.image}" alt="${student.name}" class="profile-thumb">
            <h3>${student.name}</h3>
            <p><strong>Dept:</strong> ${student.department}</p>
            <p><strong>Year:</strong> ${student.year}</p>
            <p><strong>Skills:</strong> ${student.skills.join(", ")}</p>
            <button ${alreadySent ? "disabled" : ""} onclick="connectWith('${student.name}', this)">
                ${alreadySent ? "âœ… Requested" : "ğŸ¤ Connect"}
            </button>
        `;
                studentList.appendChild(card);
            });
        }

        function connectWith(name, buttonElement) {
            const student = students.find(s => s.name === name);
            if (!student) return;

            let incomingRequests = JSON.parse(localStorage.getItem("incomingRequests") || "[]");

            const alreadySent = incomingRequests.some(req => req.name === student.name);
            if (alreadySent) {
                alert(`You have already sent a request to ${student.name}`);
                return;
            }

            incomingRequests.push({
                name: student.name,
                department: student.department,
                year: student.year,
                image: student.image, // ğŸ‘ˆ Add image
                skills: student.skills // ğŸ‘ˆ (Optional) Add skills if needed
            });


            localStorage.setItem("incomingRequests", JSON.stringify(incomingRequests));

            // Update button UI
            buttonElement.disabled = true;
            buttonElement.innerText = "âœ… Requested";

            updateConnectionsBadge();

            alert(`Connection request sent to ${student.name}`);
        }


        // Filter listeners
        document.getElementById("departmentFilter").addEventListener("change", e => {
            renderStudents(e.target.value, yearFilter.value, skillFilter.value);
        });

        document.getElementById("yearFilter").addEventListener("change", e => {
            renderStudents(departmentFilter.value, e.target.value, skillFilter.value);
        });

        document.getElementById("skillFilter").addEventListener("change", e => {
            renderStudents(departmentFilter.value, yearFilter.value, e.target.value);
        });

        // Initial render
        renderStudents();

        function updateConnectionsBadge() {
            const badge = document.getElementById("connectionsBadge");
            const incomingRequests = JSON.parse(localStorage.getItem("incomingRequests") || "[]");
            if (incomingRequests.length > 0) {
                badge.innerText = incomingRequests.length;
                badge.style.display = "inline-block";
            } else {
                badge.style.display = "none";
            }
        }
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark-mode');

        }

        const toggleBtn = document.getElementById("toggleModeBtn");
        const root = document.documentElement;

        if (localStorage.getItem("theme") === "dark") {
            root.classList.add("dark-mode");
            toggleBtn.textContent = "â˜€ï¸ Light Mode";
        }

        toggleBtn.addEventListener("click", () => {
            root.classList.toggle("dark-mode");
            const isDark = root.classList.contains("dark-mode");
            toggleBtn.textContent = isDark ? "â˜€ï¸ Light Mode" : "ğŸŒ™ Dark Mode";
            localStorage.setItem("theme", isDark ? "dark" : "light");
        });

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            showSection('home');
            renderPosts(posts);
        });



    </script>

</body>

</html>